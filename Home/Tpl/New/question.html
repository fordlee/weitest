<include file="Public:header" /> 

<eq name='isTests' value='1'>
<script type="text/javascript" src="/Public/new/test_common.js"></script>
<script type="text/javascript">
	var testConfig={$testOptions};
</script>
</eq>

<div id="container">
	<div id="container-box1">
		<div id="container-content">

			<div id="vas-container" style="display:block;visibility: hidden;position:absolute;left:0px;top:0px;width:100%;height:100%;background:#111;overflow:hidden;z-index:99;">
			</div>

			<div class="page-question">
				<h1>{$qitem.content}</h1>
				<div id="content-test">
					<a href="javascript:;" onclick="<eq name='isTests' value='1'>fbLogin();<else/>analyze();</eq>" style="display:block;background:none!important;">
						<img alt="{$qitem.content}" src="{:C('IMAGEQ_PATH')}/{$qitem.bgpic}" id="questionpic" style="width:80%;cursor:pointer">
					</a>				
				</div>
				<a href="javascript:;" onclick="<eq name='isTests' value='1'>fbLogin();<else/>analyze();</eq>" class="test-login login" style="width:81%;">
					<img src="__PUBLIC__/new/img/facebook.png">
					<span>{$languageTp.login}</span>
				</a
				><a href="javascript:;" onclick="share('{$qid}','{$sharePath}')" fid="{$uid}" class="test-share login">
					<img src="/Public/new/img/facebook.png"><span>Share</span>
				</a>

			</div>

			<div class="page-analyze" style="display:none;">
				
				<div id="content-title">
					<span class="title-text">{$qitem.content}</span>
					<div class="title-tool">
						<div class="fb-like" data-href="{$languageTp.facebook_like}" data-layout="button_count" data-action="like" data-size="large" data-show-faces="false" data-share="false"></div>
						<a id="linkComment" href="#comment" title="Comments"><img src="__PUBLIC__/new/img/facebook.gif?t=1"></a>
					</div>
				</div>
				<div id="progressbar">
					<div></div>
				</div>
				<img id="analyse" src="__PUBLIC__/new/img/analysing.gif?t=1">
				<h3 id="test-result">{$languageTp.loading_txt}</h3>
				<div id="test-line">
					<hr style="border-top:1px solid #c6c6c6;margin: 0px 10px;border-bottom: #eee;">
					<h3>{$languageTp.facebook_like_txt}</h3>
				</div>
				<div class="like-amount">
					<img src="__PUBLIC__/new/img/arrow_right.gif">
					<div class="fb-like" data-href="{$languageTp.facebook_like}" data-layout="button_count" data-action="like" data-size="large" data-show-faces="false" data-share="false"></div>
			    </div>

			</div>

			<div class="page-tests" style="display:none;">
				
				<div id="content-title">
					<span class="title-text">{$qitem.content}</span>
					<div class="title-tool">
						<div class="fb-like" data-href="{$languageTp.facebook_like}" data-layout="button_count" data-action="like" data-size="large" data-show-faces="false" data-share="false"></div>
						<a id="linkComment" href="#comment" title="Comments"><img src="__PUBLIC__/new/img/facebook.gif?t=1"></a>
					</div>
				</div>

				<div id="content-option">
					<div class="glass-mask" style="background-image:url(/Public/new/img/test.jpg)"></div>
					<img src="__PUBLIC__/new/img/empty.png" id="portrait">
					<div id="option-question">
						<h3></h3>
						<div id="option-box">
						</div>
					</div>
				</div>
			</div>

		</div>

		<div class="as600x300">
			<!-- Mytests-new_600x300 -->
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>  
            <script type="text/javascript">
              if (window.innerWidth <= 600) {
                // Small ad
              google_ad_slot = "4875650102";
              google_ad_width = 336;
              google_ad_height = 280;
              } else {
                // Medium (fallback) ad
                google_ad_slot = "7748391305";
                google_ad_width = 600;
                google_ad_height = 300;
              }
              try{
                document.write('<ins class="adsbygoogle" style="display:inline-block;width:'+google_ad_width+'px;height:'+google_ad_height+'px" data-ad-client="ca-pub-3961823097646209" data-ad-slot="'+google_ad_slot+'" data-ad-region="MYTESTS_MID"></ins>');
                (adsbygoogle = window.adsbygoogle || []).push({});      
              }catch(e){
                console.log(e);
              }
            </script>
		</div>

		<div class="randombtnbox">
			<hr style="border:1px dashed #c6c6c6;border-bottom:none;width:98%">
			<a href="{:U('Index/question')}/id/{:rand(1,24)}{$utm}" class="randombtn btn">
	            <span>NEXT</span>
	            <img src="__PUBLIC__/new/img/arrow2.png">
	        </a>
		</div>

        <volist name="item" id="v" offset="0" length="4">
	        <a class="test-box" href="{:U('Index/question')}/id/{$v.id}{$utm}">
	        	<img class="lazy" src="__PUBLIC__/new/img/empty.png" data-original="{:C('IMAGEQ_PATH')}/{$v.icon}" alt="{$v.content}">
	        	<div class="test-question">{$v.content}</div>
	        </a>
	    </volist>	
	    	
        <div id="comment">
			<div class="fb-comments" data-href="http://{$Think.server.HTTP_HOST}/index/question/id/{$qid}" data-width="100%" data-numposts="5"></div>
        </div>

		<div class="as320x280 as320280 as320x280-below" style="display:none;">
			<script type="text/javascript">
			if (window.innerWidth <600) {
				/*-- Mytests-new_336x280-replace_mobile_bot --*/
				google_ad_slot = "8834844904";
				google_ad_width = 336;
				google_ad_height = 280;

				try{
					document.write('<ins class="adsbygoogle" style="display:inline-block;width:'+google_ad_width+'px;height:'+google_ad_height+'px" data-ad-client="ca-pub-3961823097646209" data-ad-slot="'+google_ad_slot+'" data-ad-region="MYTESTS_BOT"></ins>');
					(adsbygoogle = window.adsbygoogle || []).push({});      
				}catch(e){
					console.log(e);
				}

			  }
			</script>
		</div>

        <volist name="item" id="v" offset="4" length="6">
	        <a class="test-box" href="{:U('Index/question')}/id/{$v.id}{$utm}">
	        	<img class="lazy" src="__PUBLIC__/new/img/empty.png" data-original="{:C('IMAGEQ_PATH')}/{$v.icon}" alt="{$v.content}">
	        	<div class="test-question">{$v.content}</div>
	        </a>
	    </volist>

        <div class="randombtnbox randombtnboxdis">
			<hr style="border:1px dashed #c6c6c6;border-bottom:none;width:98%">
			<a href="{:U('Index/question')}/id/{:rand(1,24)}{$utm}" class="randombtn btn">
	            <span>NEXT</span>
	            <img src="__PUBLIC__/new/img/arrow2.png">
	        </a>
		</div>

	</div>

	<include file="Public:rightbar" />

	<div id="mytest">
		<div>
			<div class="fb-page" data-href="{$languageTp.facebook_like}" data-tabs="timeline" data-width="300" data-height="500" data-small-header="true" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"><blockquote cite="https://www.facebook.com/pt.mytests.co/" class="fb-xfbml-parse-ignore"><a href="{$languageTp.facebook_like}">Mytests.co</a></blockquote></div>
		</div>
		<a href="#header"><img src="__PUBLIC__/new/img/back.png"></a>
	</div>
</div>

<script type="text/javascript" src="__PUBLIC__/new/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/new/ads.js"></script>
<script type="text/javascript">

function share(qid,pic){
	var url=location.protocol+'//'+location.host+'/index/questions/id/'+qid+'/tag/share/pic/'+pic+'/t/{:rand(1,200);}';
	var utm=getQueryString('utm');
	var version=getQueryString('v');
	if(utm)url=url+'/utm/'+utm;
	if(version==1)url=url+'/v/'+version;
	url=encodeURIComponent(url);
	
    openwindow('https://www.facebook.com/sharer/sharer.php?u='+url,'',800,500);
}

function getQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return unescape(r[2]); return null;
}
function openwindow(url,name,iWidth,iHeight){
    var url;
    var name;
    var iWidth;
    var iHeight;
    var iTop = (window.screen.availHeight-30-iHeight)/2;
    var iLeft = (window.screen.availWidth-10-iWidth)/2;
    window.open(url,name,'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=yes,location=no,status=no');
}

var timeFlag=new Date().getTime();
var resultUrl="{:U('Result/show')}/id/{$qid}";
var utm="{$utm}";

function fbLogin(){
	function showTests(){
		$('.page-tests').show();$('.page-question,.page-analyze').hide();
		testModule.start();
	}
	showTests();return;

    FB.login(function(response) { 
        statusChangeCallback(response);  //登录回调函数
    },{scope: 'email'});  //需要获取的信息scope

	var statusChangeCallback = function (response){
	    if (response.status === 'connected') {
	        var accessToken = response.authResponse.accessToken; //取得 accessToken
	    
	        FB.api('/me?fields=name,first_name,last_name,email', function(response) {
	            if(response.email!=null){
	            }else{
	                alert("XXX.");
	            }
	        });
	    }else{

	    }
	};
}

function analyze(param){
    window.scrollTo(0,165);
    try{
        GameAds.init();
    }catch(e){};

    var param=param||{},rid=null;
    if(typeof param.rid!='undefined'){
    	rid=param.rid;
    	resultUrl+='/rid/'+rid;
    }

    $('.page-analyze').fadeIn('fast');$('.page-question,.page-tests').hide();
    $('.test-title').addClass('testing-title');
    try{
        var stateObject = {};
        var newUrl = "{:U('Result/analyze')}/id/{$qid}{$utm}";
        history.pushState(stateObject,document.title,newUrl);
    }catch(e){}

    $('#progressbar>div').animate({width:"99%"},10000);

    window.timeFlag=new Date().getTime();
    //return;
    $.post("{:U('Result/show')}",{ id:{$qid},tag:'analyze',utm:"{$Think.get.utm}",v:"{$Think.get.v}",rid:rid},function(response){
        //Facebook un login
        if(response.login==false){
			<eq name="Think.get.utm" value="app">
			getLoginStatus();
			<else/>
			setTimeout(function(){
				location.href=response.loginUrl;
			},10*1000);
            
			</eq>
        }else{
			var _resultUrl=resultUrl+(response.tokens?('/tokens/'+response.tokens):"")+utm;
            var timeNow=new Date().getTime(),diff=(timeNow-timeFlag)/1000;
            if(diff>10){
                location.href=_resultUrl;
            }else{
                console.log(diff);
                setTimeout(function(){
                    location.href=_resultUrl;
                },(10-diff)*1000);
            }
        }
    });

    setTimeout(function(){
        location.href=resultUrl+utm;
    },12*1000);
}

<eq name="Think.const.ACTION_NAME" value="analyze">
analyze();
</eq>

</script>
<include file="Public:footer" /> 